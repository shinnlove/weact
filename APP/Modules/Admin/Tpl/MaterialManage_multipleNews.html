<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/bootstrap/css/bootstrap2.2.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/uniform/themes/default/css/uniform.default.css" media="screen" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/jquery-easyui-1.3.5/themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/colorBtnMyUniform.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/singleNewsStyle.css?v=1.0.1" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/appmsg.css?v=1.0.1" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/appmsg-mul.css?v=1.0.1" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/om-fileupload.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/ueditor2/themes/default/css/ueditor.css" />
<script type="text/javascript" src="__PUBLIC__/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/uniform/jquery.uniform.js"></script>
<script type="text/javascript" src="__PUBLIC__/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/jquery-easyui-1.3.5/jquery.easyui.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/operamasks-ui.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/operamasks/ui/om-core.js"></script>
<script type="text/javascript" src="__PUBLIC__/operamasks/ui/om-fileupload.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.json-2.4.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor2/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor2/ueditor.all.js"></script>
<title>多图文添加</title>
</head>

<body>
	<div class="row">
		<div class="span5 msg-preview">
			<div class="msg-item-wrapper">
				<div id="appmsgItem1" class="appmsgItem msg-item">
					<p class="msg-meta">
						<span class="msg-date">{$date}</span>
					</p>
					<div class="cover" style="margin-top: 20px;">
						<p class="default-tip">封面图片</p>
						<h4 class="msg-t">
							<span class="i-title" style="line-height: 24px; color: #FFF;">标题</span>
						</h4>
						<ul class="abs tc sub-msg-opr">
							<li class="b-dib sub-msg-opr-item">
								<a href="javascript:;" class="th opr-icon edit-icon">编辑</a>
							</li>
						</ul>
						<img class="i-img" alt="" style="" />
					</div>
					<p class="msg-text"></p>

					<input type="hidden" class="title" value="" />
					<input type="hidden" class="cover" value="" />
					<input type="hidden" class="coverurl" value="" />
					<textarea class="content" style="display: none;"></textarea>
					<input type="hidden" class="sourceurl" value="" />
					<input type="hidden" class="chain" value="" />
				</div>
				<div class="rel sub-msg-item appmsgItem">
					<span class="thumb">
						<span class="default-tip" style="">缩略图</span>
						<img src="" class="i-img" alt="" style="display: none;" />
					</span>
					<h4 class="msg-t">
						<span class="i-title">标题</span>
					</h4>
					<ul class="abs tc sub-msg-opr">
						<li class="b-dib sub-msg-opr-item"><a href="javascript:;" class="th opr-icon edit-icon">编辑</a></li>
						<li class="b-dib sub-msg-opr-item"><a href="javascript:;" class="th opr-icon del-icon">删除</a></li>
					</ul>
					<input type="hidden" class="title" />
					<input type="hidden" class="cover" />
					<input type="hidden" class="coverurl" />
					<textarea class="content" style="display: none;"></textarea>
					<input type="hidden" class="sourceurl" />
					<input type="hidden" class="chain" />
				</div>

				<div class="sub-add">
					<a href="javascript:;" class="block tc sub-add-btn"><span class="vm dib sub-add-icon"></span>增加一条</a>
				</div>
			</div>
		</div>
		<div class="span7" style="width:450px;">
			<div class="msg-editer-wrapper">
				<div class="msg-editer">
					<div class="control-group">
						<label class="control-label">标题</label><span class="maroon">*</span><span
							class="help-inline">(必填，不能超过36个字)</span>
						<div class="controls">
							<input type="text" id="title" name="title" class="span5 uniform newsinput" placeholder="请输入图文信息的标题" required="required" value="" />
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">封面</label><span class="maroon">*</span>
						<span class="help-inline">(必须上传一张图片)</span>
						<div class="controls">
							<div class="cover-area">
								<div class="cover-hd">
									<input id="file_upload" name="file_upload" type="file" />
									<input id="picsort" name="picsort" type="hidden" value="lanmu" />
									<input id="coverurl" value="" name="coverurl" type="hidden" />
								</div>
								<p id="upload-tip" class="upload-tip recommend">大图片建议尺寸：900像素 × 500像素</p>
								<p id="imgArea" class="cover-bd" style="display: none;">
									<img id="img" src="" alt="" />
									<a href="javascript:;" id="delImg" class="vb cover-del" alt="" />删除</a>
								</p>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">正文</label> <span class="maroon">*</span>
						<span class="help-inline">(必填，不能超过10000个字符)</span>
						<div class="controls">
							<script type="text/plain" id="editor"></script>
						</div>
					</div>
					<a id="chain-block-link" href="javascript:void(0);"
						class="url-link block">添加外链（适用引导活动）</a>
					<div id="chain-block" style="display: none;" class="control-group">
						<label class="control-label">外链地址</label> <span
							class="help-inline warning">(设置后点击图文不会进入详情，而跳转外链地址；留空取消外链)</span>
						<div class="controls">
							<input type="text" id="chain" name="chain" class="span5 uniform newsinput" placeholder="所添加的链接请以http://开头" required="required" value="" />
						</div>
					</div>
					<a id="url-block-link" href="javascript:void(0);"
						class="url-link block">添加原文链接（适用导读消息）</a>
					<div id="url-block" style="display: none;" class="control-group">
						<label class="control-label">原文链接</label> <span
							class="help-inline warning">(在图文详情页面中会生成阅读原文链接；留空取消原文链接)</span>
						<div class="controls">
							<input type="text" id="source_url" name="source_url" class="span5 uniform newsinput" placeholder="所添加的链接请以http://开头" required="required" value="" />
						</div>
					</div>

					<hr />

					<div class="control-group">
						<a id="save-btn" class="large ui-color-button light-green" href="javascript:void(0)">保存</a>
						&nbsp;&nbsp;
						<a id="cancel-btn" class="large ui-color-button blue" href="javascript:void(0)">取消</a>
					</div>
					<!-- <input id="action" name="action" type="hidden" value="{:U('Admin/MaterialNews/addMulNews')}" /> -->
				</div>
				<span class="abs msg-arrow a-out" style="margin-top: 0px;"></span>
				<span class="abs msg-arrow a-in" style="margin-top: 0px;"></span>
			</div>
		</div>
	</div>

<script type="text/javascript">
var submitURL = "{:U('Admin/MaterialManageRequest/addMulNewsConfirm')}"; 	// 提交数据的URL地址
var charLimit = 10000;												// 字符数限制全局变量

$(function(){
	$(".uniform").uniform();
	
	var msg_editor = UE.getEditor('editor',{
		imageUrl : "{:U('Admin/MaterialManageRequest/multipleNewsImageHandle', '', '')}",
		imagePath : "__ROOT__",
		initialFrameWidth: 400,
		initialFrameHeight: 360
	});
	
	msg_editor.addListener('beforeInsertImage', function (t, arg) {
		for(i=0; i<arg.length; i++){
			arg[i].width = 320; // 监听ueditor图片插入，插入前设置图片宽度。
		}
	});
	
    $("#file_upload").omFileUpload({
        action: "{:U('Admin/MaterialManageRequest/multipleNewsCoverHandle', '', '')}",
        swf : '__PUBLIC__/operamasks/ui/om-fileupload.swf',
        fileExt: "*.jpg;*.png;*.gif;*.jpeg;*.bmp",
        fileDesc: "Image Files",
        sizeLimit: 200 * 1024,
        autoUpload : true,
		method : 'GET',
		removeCompleted : true,
        onError: function(ID, fileObj, errorObj, event) {
            if (errorObj.type == "File Size") {
            	$.messager.alert('温馨提示', '上传图片的大小不能超过200KB!', 'warning');
            }
        },
        actionData: {
            picsort: $("#picsort").val()
        },
        onComplete: function(ID, fileObj, response, data, event) {
            var jsonData = eval("(" + response + ")");
            if (jsonData.error == "filetype") {
            	$.messager.alert('温馨提示', "文件上传格式只能支持：" + jsonData.allowtype, 'warning');
                return false
            }
            //上传封面成功后页面操作：
            $(".default-tip", window.appmsg).hide();							//原始“封面图片”字样隐藏（无图）
            $(".i-img", window.appmsg).attr("src", jsonData.fileUrl).show();	//在封面上预览图片框出现，.i-img是预览图片框的
            $("#imgArea").show().find("#img").attr("src", jsonData.fileUrl);	//所上传的图片在编辑区的预览块显示预览，#imgArea是编辑区预览图片的
            $(".cover", window.appmsg).val(jsonData.fileName);					//封面图片绑定封面的文件名（需服务器端返回fileName的json，暂无处理）
            $(".coverurl", window.appmsg).val(jsonData.fileUrl);				//封面图片隐藏input写入文件路径
        }
    });
    
	//绑定msg-editer的标题变动事件
    $(".msg-editer #title").bind("keyup", function(){
    	var current_title = $(this).val();								//抓取当前标题current_title
        if(current_title) {
        	$(".i-title", window.appmsg).text(current_title);			//如果不为空，直接将标题展现在页面上
        }else {
        	$(".i-title", window.appmsg).text('标题');					//如果空，则恢复'标题'两字
        }
        $(".title", window.appmsg).val(current_title);					//隐藏在input里的值
    });
	//绑定msg-editer的外链变动事件
    $(".msg-editer #chain").bind("keyup", function(){
        $(".chain", window.appmsg).val($(this).val())					//只要外链变动，直接写入对应的input隐藏框里
    });
	//绑定msg-editer的原文链接变动事件
    $(".msg-editer #source_url").bind("keyup", function(){
        $(".sourceurl", window.appmsg).val($(this).val())				//只要原文链接变动，直接写入对应的input隐藏框里
    });
	//点击外文链接显示输入框
    $("#chain-block-link").click(function(){
        $("#chain-block").show();										//外链输入框出现
        $(this).hide()													//隐藏外链字样
    });
	//点击原文链接显示输入框
    $("#url-block-link").click(function(){
        $("#url-block").show();											//原文链接输入框出现
        $(this).hide()													//隐藏原文链接字样
    });
	//点击删除图片的函数
    $("#delImg").click(function(){
        $(".default-tip", window.appmsg).show();						//原始“封面图片”字样出现（无图）
        $("#imgArea").hide();											//所上传的图片在编辑区的预览块隐藏，#imgArea是编辑区预览图片的
        $(".cover,.coverurl", window.appmsg).val("");					//封面图片路径清空
        $(".i-img", window.appmsg).hide()								//在封面上预览图片框隐藏，.i-img是预览图片框的
        //如果此处omfileupload的自动关闭进度条属性removeCompleted值是false，删除图片同时还需将进度条直接隐藏掉
    });
	//点击取消编辑图文按钮
    $("#cancel-btn").click(function(event){
    	$.messager.confirm('温馨提示', '确定放弃当前编辑的图文？', function(r){
			if(r) history.go(-1);
		});
    });
	//绑定子消息鼠标上去效果
    $("#appmsgItem1,.sub-msg-item").on({
        mouseover: function() { $(this).addClass("sub-msg-opr-show") },	//鼠标移动到某条图文上添加蒙版的样式
        mouseout: function() { $(this).removeClass("sub-msg-opr-show") }//鼠标移动到某条图文上移除蒙版的样式
    });
    /*添加一条子信息开始*/
	$(".sub-add-btn").click(function() {
        var len = $(".sub-msg-item").size();							//抓取页面上子图文.sub-msg-item的数量
        if (len >= 9) {
        	$.messager.alert('温馨提示', '最多只能加入10条图文信息!', 'warning');	//扣除主图文，最多再允许10条子图文，再扣除第一条子图文，是9
            return
        }
        var $lastItem = $(".sub-msg-item:last");						//抓取最后一条子图文对象
        var $newItem = $lastItem.clone();								//克隆复制成新图文$newItem（可能有值）
        $("input,textarea", $newItem).val("");							//清空新图文的input与textarea框里的值（原来可能有值）
        $(".i-title", $newItem).text("标题");								//新图文默认显示标题
        $(".default-tip", $newItem).css("display", "block");			//“封面图片”字样再次出现（因为新图文无图预览）
        $(".cover,.coverurl", $newItem).val("");						//清空图片路径和图片名称（原来可能有值）
        $(".i-img", $newItem).hide();									//.i-img预览图片框隐藏
        //$(".rid", $newItem).remove();
        $lastItem.after($newItem);										//新图文附加在最后一条图文上
		$newItem.on({
			mouseover: function() { $(this).addClass("sub-msg-opr-show") },
			mouseout: function() { $(this).removeClass("sub-msg-opr-show") }
		});
        //对新图文的edit-icon编辑标签进行绑定事件（原来的编辑事件不能克隆）
		$newItem.find('.sub-msg-opr .edit-icon').on("click", function(){
			window.appmsg.find(".content").val(msg_editor.getContent());//获取.content里的内容
			var $msgItem = $(this).closest(".appmsgItem");				//找到这个图文的信息的div框
			var index = $(".appmsgItem").index($msgItem);				//获取编号
			window.appmsgIndex = index;									//确定这条消息的顺序
			window.appmsg = $msgItem;
			//Step1：编辑时对标题的处理
			$("#title").val($(".title", $msgItem).val());				//从$msgItem中找title，并绑定编辑器的标题（可能为空，也可能已编辑过）
			//Step2：编辑时对编辑区封面图片块的预览处理
			if ($(".coverurl", $msgItem).val() == "") {
				$("#imgArea").hide();									//从$msgItem中找封面路径coverurl，如果没有上传过封面，直接隐藏编辑器里的封面预览块
			} else {
				$("#imgArea").show().find("#img").attr("src", $(".coverurl", $msgItem).val());	//否则显示编辑器里的封面预览块
			}
			//Step3：编辑时对编辑区外链处理
			if ($(".chain", $msgItem).val() == "") {
				$("#chain-block-link").show();
				$("#chain-block").hide().find("#chain").val("");
			} else {
				$("#chain-block-link").hide();
				$("#chain-block").show().find("#chain").val($(".chain", $msgItem).val());
			}
			//Step3：编辑时对编辑区原文链接处理
			if ($(".sourceurl", $msgItem).val() == "") {
				$("#url-block-link").show();
				$("#url-block").hide().find("#source_url").val("");
			} else {
				$("#url-block-link").hide();
				$("#url-block").show().find("#source_url").val($(".sourceurl", $msgItem).val());
			}
			//Step4：编辑时对编辑区正文内容的处理
			msg_editor.setContent($(".content", $msgItem).val());
			//Step5：编辑时对编辑框高度的处理
			if (index == 0) {
				$(".msg-editer-wrapper").css("margin-top", "0px")
			} else {
				var top = 110 + $(".sub-msg-item").eq(0).outerHeight(true) * index;		//每条子图文的高度是110px，计算移动多少像素
				$(".msg-editer-wrapper").css("margin-top", top + "px")
			}
			//Step6：进行温馨提示
			$(".recommend").html("小图片建议尺寸：200像素 × 200像素");
		});
		//对新图文的edit-icon删除标签进行绑定事件（原来的删除事件不能克隆）
		$newItem.find('.sub-msg-opr .del-icon').on("click", function(){
			var len = $(".appmsgItem").size();
			if (len <= 2) {
				$.messager.alert('温馨提示', '无法删除，多图文至少需要2条消息!', 'warning');
				return
			}
			var target = $(this);														//进入easyUI会使$(this)失效，先抓取
			$.messager.confirm('温馨提示', '确认删除此消息？', function(r){
				if(r) {
					window.appmsg.find(".content").val(msg_editor.getContent());		//保存刚编辑的内容
					target.closest(".sub-msg-item").remove();							//抓取要删除的子图文div并删除它
					window.appmsgIndex = 0;												//重定义当前消息索引从第一条开始
				    window.appmsg = $("#appmsgItem1");
				    var $msgItem = window.appmsg;
				    msg_editor.setContent($(".content", $("#appmsgItem1")).val());
				    $(".edit-icon", $msgItem).click();									//选中第一条图文
				}
			});
		});
    });
	/*添加一条子信息结束*/
	//原来的主消息和原来的第一条子消息编辑按钮
    $(".sub-msg-opr .edit-icon").on("click", function(){
    	window.appmsg.find(".content").val(msg_editor.getContent());//获取.content里的内容
		var $msgItem = $(this).closest(".appmsgItem");				//找到这个图文的信息的div框
		var index = $(".appmsgItem").index($msgItem);				//获取编号
		window.appmsgIndex = index;									//确定这条消息的顺序
		window.appmsg = $msgItem;
    	
		//Step1：编辑时对标题的处理
		$("#title").val($(".title", $msgItem).val());				//从$msgItem中找title，并绑定编辑器的标题（可能为空，也可能已编辑过）
		//Step2：编辑时对编辑区封面图片块的预览处理
		if ($(".coverurl", $msgItem).val() == "") {
			$("#imgArea").hide();									//从$msgItem中找封面路径coverurl，如果没有上传过封面，直接隐藏编辑器里的封面预览块
		} else {
			$("#imgArea").show().find("#img").attr("src", $(".coverurl", $msgItem).val());	//否则显示编辑器里的封面预览块
		}
		//Step3：编辑时对编辑区外链处理
		if ($(".chain", $msgItem).val() == "") {
			$("#chain-block-link").show();
			$("#chain-block").hide().find("#chain").val("");
		} else {
			$("#chain-block-link").hide();
			$("#chain-block").show().find("#chain").val($(".chain", $msgItem).val());
		}
		//Step4：编辑时对编辑区原文链接处理
		if ($(".sourceurl", $msgItem).val() == "") {
			$("#url-block-link").show();
			$("#url-block").hide().find("#source_url").val("");
		} else {
			$("#url-block-link").hide();
			$("#url-block").show().find("#source_url").val($(".sourceurl", $msgItem).val());
		}
		//Step5：编辑时对编辑区正文内容的处理
		msg_editor.setContent($(".content", $msgItem).val());
		//Step6：编辑时对编辑框高度的处理
        if (index == 0) {
            $(".msg-editer-wrapper").css("margin-top", "0px")
            $(".recommend").html("大图片建议尺寸：900像素 × 500像素");		//如果选中了主消息
        } else {
        	$(".recommend").html("小图片建议尺寸：200像素 × 200像素");		//如果选中了子消息
            var top = 110 + $(".sub-msg-item").eq(0).outerHeight(true) * index;
            $(".msg-editer-wrapper").css("margin-top", top + "px")
        }
    });
	//原来的主消息和原来的第一条子消息删除
    $(".sub-msg-opr .del-icon").on("click", function(){
        var len = $(".appmsgItem").size();
        if (len <= 2) {
        	$.messager.alert('温馨提示', '无法删除，多图文至少需要2条消息!', 'warning');
            return
        }
        var target = $(this);														//进入easyUI会使$(this)失效，先抓取
		$.messager.confirm('温馨提示', '确认删除此消息？', function(r){
			if(r) {
				window.appmsg.find(".content").val(msg_editor.getContent());		//保存刚编辑的内容
				target.closest(".sub-msg-item").remove();							//抓取要删除的子图文div并删除它
				window.appmsgIndex = 0;												//重定义当前消息索引从第一条开始
			    window.appmsg = $("#appmsgItem1");
			    var $msgItem = window.appmsg;
			    msg_editor.setContent($(".content", $("#appmsgItem1")).val());
			    $(".edit-icon", $msgItem).click();									//选中第一条图文
			}
		});
    });
	
    window.appmsgIndex = 0;															//初始化页面定义当前消息索引从第一条开始
    window.appmsg = $("#appmsgItem1");
	
	//保存图文信息按钮
    $("#save-btn").click(function() {
        var $btn = $(this);															//抓取保存按钮对象
        if ($btn.hasClass("disabled")) return										//如果不能保存图文（因为一些图文条数超过限制的原因）
        window.appmsg.find(".content").val(msg_editor.getContent());
        window.appmsgIndex = -1;
        var valid = true;															//该标记很重要，不要删除!尝试过删除，但是会出错!
        var $msgItem;
        var jsonData = [];
        $(".appmsgItem").each(function(index, msgItem) {
            $msgItem = $(msgItem);
            var title = $("input.title", $msgItem).val();
            var cover = $("input.cover", $msgItem).val();
            var coverurl = $("input.coverurl", $msgItem).val();
            var content = $("textarea.content", $msgItem).val();
            /*----核心代码----*/
            window.appmsgIndex = index;
            window.appmsg = $msgItem;
            msg_editor.setContent($(".content", $msgItem).val());
            var current_length = msg_editor.getContentLength(true);					//true代表计算忽略html的纯文本（中文一个字算一个）
            /*----核心代码----*/
            var reg = /^(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/; // 匹配网址的正则表达式
            var chain = $("input.chain", $msgItem).val();
            var sourceurl = $("input.sourceurl", $msgItem).val();
            if (title == "") {
            	$.messager.alert('温馨提示', "第" + (index + 1) + "条图文消息的标题不能为空!", 'warning');
            	$(".edit-icon", $msgItem).click();				//选中超过字数的图文
            	valid = false;
                return false
            }
            if (coverurl == "") {
            	$.messager.alert('温馨提示', "第" + (index + 1) + "条图文消息必须上传一个封面图片!", 'warning');
            	$(".edit-icon", $msgItem).click();				//选中没有上传封面图片的图文
            	valid = false;
                return false
            }
            if (content == "" && chain == "") {
            	$.messager.alert('温馨提示', "第" + (index + 1) + "条图文消息的正文内容或者外链至少要填写一个!", 'warning');
            	$(".edit-icon", $msgItem).click();				//选中超过字数的图文
            	valid = false;
                return false
            }
            if(current_length > charLimit){
            	$.messager.alert('温馨提示', "第" + (index + 1) + "条图文消息的正文内容不能超过" + charLimit + "个字!", 'warning');	//^_^已验证正确提示
            	$(".edit-icon", $msgItem).click();				//选中超过字数的图文
            	valid = false;
                return false
            }
            if (chain != "") {
            	var chainreg = chain.match(reg);
            	if(!chainreg){
					$.messager.alert('温馨提示', "第" + (index + 1) + "条图文消息外部链接网址不合法，请输入正确的网址，以http://或https://开头!", 'warning', function(){
						$(".edit-icon", $msgItem).click();		//选中超过字数的图文
			  		});
					valid = false;
					return false;
				}
            }
            if (sourceurl != "") {
            	var sourceurlreg = sourceurl.match(reg);
            	if(!sourceurlreg){
					$.messager.alert('温馨提示', "第" + (index + 1) + "条图文消息原文链接网址不合法，请输入正确的网址，以http://或https://开头!", 'warning', function(){
						$(".edit-icon", $msgItem).click();		//选中超过字数的图文
			  		});
					valid = false;
					return false;
				}
            }
            
			//将所有的图文消息打包成jsonData
            jsonData[index] = {
                title: title,
                cover: cover,
                coverurl: coverurl,
                content: content,
                chain: chain,
                sourceurl: sourceurl
            };
        });
		if (!valid) {
            $(".edit-icon", $msgItem).click();					// 默认某条图文编辑状态
            return false
        }
        var sumbitData = {
            jsonData: $.toJSON(jsonData)						// 调用toJSON压缩数据
        };
        $btn.addClass("disabled");								// 暂停点击保存按钮
        //进行图文数据的提交
        $.post(submitURL, sumbitData, function(result) {
            $btn.removeClass("disabled");						// 提交后得到服务器端返回时候，保存按钮才可以再次点击（该方法可以用于别的地方）
            if (result.errCode == 0) {
            	$.messager.alert('温馨提示', '保存成功。', 'info', function(){
            		window.location.href = "{:U('Admin/MaterialManage/newsView', '', '')}";	// 添加成功后直接跳转到图文中心预览
            	});
            } else {
            	$.messager.alert('温馨提示', '保存失败，'+result.errMsg, 'error');
            }
        },"json")
    });
	
});
</script>
</body>
</html>